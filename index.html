<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Expense Splitter</title>
    <link rel="stylesheet" href="style.css">
    <!-- CRITICAL PDF FIX: Load jsPDF first -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Then load autotable plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <!-- XLSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <h1 class="app-title">Tour Expense Splitter v3</h1>
                    <div class="header-actions">
                        <select id="tourSelector" class="form-control tour-selector">
                            <option value="">Select a tour</option>
                        </select>
                        <button class="btn btn--primary" id="newTourBtn">New Tour</button>
                    </div>
                </div>
                <div class="tour-info" id="tourInfo">
                    <h2 id="currentTourName">No tour selected</h2>
                    <p id="currentTourDescription"></p>
                    <div class="export-buttons" id="exportButtons" style="margin-top: 12px; display: none;">
                        <button class="btn btn--primary export-btn" id="exportPDF">
                            ðŸ“„ Export PDF
                        </button>
                        <button class="btn btn--secondary export-btn" id="exportExcel">
                            ðŸ“Š Export Excel
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main">
            <div class="container">
                <!-- Dashboard -->
                <div class="dashboard" id="dashboard">
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <h3>Total Expenses</h3>
                            <p class="stat-value" id="totalExpenses">$0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Hotel Costs</h3>
                            <p class="stat-value" id="hotelCosts">$0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Transport Costs</h3>
                            <p class="stat-value" id="transportCosts">$0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Members</h3>
                            <p class="stat-value" id="totalMembers">0</p>
                        </div>
                        <div class="stat-card">
                            <h3>Daily Average</h3>
                            <p class="stat-value" id="dailyAverage">$0</p>
                        </div>
                    </div>
                    
                    <!-- Statistics Section -->
                    <div class="statistics-section">
                        <h3>Expense Statistics</h3>
                        <div class="charts-container">
                            <div class="chart-wrapper">
                                <h4>Category Breakdown</h4>
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="categoryChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-wrapper">
                                <h4>Daily Expenses Trend</h4>
                                <div class="chart-container" style="position: relative; height: 300px;">
                                    <canvas id="dailyChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="btn btn--primary" id="quickAddExpense">Add Expense</button>
                        <button class="btn btn--secondary" id="quickAddMember">Add Member</button>
                        <button class="btn btn--outline" id="viewBalances">View Balances</button>
                    </div>
                </div>

                <!-- Tab Navigation -->
                <nav class="tab-nav">
                    <button class="tab-btn active" data-tab="members">Members</button>
                    <button class="tab-btn" data-tab="expenses">Expenses</button>
                    <button class="tab-btn" data-tab="daily">Daily View</button>
                    <button class="tab-btn" data-tab="balances">Balances</button>
                    <button class="tab-btn" data-tab="reports">Reports</button>
                </nav>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Members Tab -->
                    <div class="tab-pane active" id="membersTab">
                        <div class="tab-header">
                            <h3>Tour Members</h3>
                            <button class="btn btn--primary" id="addMemberBtn">Add Member</button>
                        </div>
                        <div class="members-list" id="membersList"></div>
                    </div>

                    <!-- Expenses Tab -->
                    <div class="tab-pane" id="expensesTab">
                        <div class="tab-header">
                            <h3>Expenses</h3>
                            <button class="btn btn--primary" id="addExpenseBtn">Add Expense</button>
                        </div>
                        <div class="expense-filters">
                            <input type="text" class="form-control" id="expenseSearch" placeholder="Search expenses...">
                            <select class="form-control" id="categoryFilter">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="expenses-list" id="expensesList"></div>
                    </div>

                    <!-- Daily View Tab -->
                    <div class="tab-pane" id="dailyTab">
                        <div class="tab-header">
                            <h3>Daily Breakdown</h3>
                            <p class="text-secondary">Excludes hotel and transportation expenses</p>
                        </div>
                        <div class="daily-view" id="dailyView"></div>
                    </div>

                    <!-- Balances Tab -->
                    <div class="tab-pane" id="balancesTab">
                        <div class="tab-header">
                            <h3>Member Balances</h3>
                            <p class="text-secondary">Formula: Final Balance = Total Paid - Total Share</p>
                        </div>
                        <div class="balances-list" id="balancesList"></div>
                        <div class="settlements">
                            <h4>Settlement Suggestions</h4>
                            <div id="settlementsList"></div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div class="tab-pane" id="reportsTab">
                        <div class="tab-header">
                            <h3>Reports & Export</h3>
                        </div>
                        <div class="export-options">
                            <button class="btn btn--primary btn--lg export-primary" id="exportPDFLarge">
                                ðŸ“„ Export Detailed PDF Report
                            </button>
                            <button class="btn btn--primary btn--lg export-primary" id="exportExcelLarge">
                                ðŸ“Š Export Excel Workbook
                            </button>
                            <button class="btn btn--secondary" id="exportCSV">Export CSV</button>
                            <button class="btn btn--outline" id="exportJSON">Export Data</button>
                        </div>
                        <div class="report-preview" id="reportPreview"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modals -->
        <!-- New Tour Modal -->
        <div class="modal hidden" id="newTourModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create New Tour</h3>
                    <button class="modal-close" id="closeTourModal">&times;</button>
                </div>
                <form id="newTourForm">
                    <div class="form-group">
                        <label class="form-label">Tour Name *</label>
                        <input type="text" class="form-control" id="tourName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="tourDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="tourStartDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date</label>
                        <input type="date" class="form-control" id="tourEndDate">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn--secondary" id="cancelTour">Cancel</button>
                        <button type="submit" class="btn btn--primary">Create Tour</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Member Modal -->
        <div class="modal hidden" id="addMemberModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Member</h3>
                    <button class="modal-close" id="closeMemberModal">&times;</button>
                </div>
                <form id="addMemberForm">
                    <div class="form-group">
                        <label class="form-label">Name *</label>
                        <input type="text" class="form-control" id="memberName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contact (Email/Phone)</label>
                        <input type="text" class="form-control" id="memberContact" placeholder="email@example.com or +1-555-0123">
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn--secondary" id="cancelMember">Cancel</button>
                        <button type="submit" class="btn btn--primary">Add Member</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Expense Modal -->
        <div class="modal hidden" id="addExpenseModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Expense</h3>
                    <button class="modal-close" id="closeExpenseModal">&times;</button>
                </div>
                <form id="addExpenseForm">
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-control" id="expenseDescription" placeholder="What was this expense for?">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount ($) *</label>
                        <input type="number" class="form-control" id="expenseAmount" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-control" id="expenseCategory" required>
                            <option value="">Select category</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date *</label>
                        <input type="date" class="form-control" id="expenseDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Who Paid? *</label>
                        <select class="form-control" id="expensePaidBy" required>
                            <option value="">Select member</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Participants</label>
                        <div class="participants-list" id="expenseParticipants"></div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn--secondary" id="cancelExpense">Cancel</button>
                        <button type="submit" class="btn btn--primary">Add Expense</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Loading and Empty States -->
        <div class="empty-state hidden" id="emptyState">
            <h3>No Tour Selected</h3>
            <p>Create a new tour or select an existing one to get started.</p>
            <button class="btn btn--primary" id="emptyNewTour">Create New Tour</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>